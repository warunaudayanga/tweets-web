<div class="vh-100 p-3">
    <div class="tweet-feed-heading mb-3 d-flex justify-content-between align-items-center gap-2">
        <div class="d-flex justify-content-start align-items-center gap-2">
            <button
                class="btn btn-sm"
                [class.btn-primary]="tab() === 'all'"
                [class.btn-outline-primary]="tab() !== 'all'"
                (click)="selectTab('all')"
            >
                All Tweets
            </button>
            <button
                class="btn btn-sm"
                [class.btn-primary]="tab() === 'my'"
                [class.btn-outline-primary]="tab() !== 'my'"
                (click)="selectTab('my')"
            >
                My Tweets
            </button>
        </div>
        <button
            class="btn btn-sm"
            [class.btn-primary]="tab() === 'create'"
            [class.btn-outline-primary]="tab() !== 'create'"
            (click)="selectTab('create')"
        >
            Create Tweet
        </button>
    </div>

    <div class="tweet-feed-wrapper overflow-auto pe-2">
        @if (tab() === 'create') {
            <div class="tweet-card">
                <textarea
                    rows="3"
                    class="form-control mb-2"
                    placeholder="What's on your mind?"
                    [(ngModel)]="newTweetContent"
                ></textarea>
                <button
                    class="btn btn-primary btn-sm"
                    (click)="createTweet()"
                    [disabled]="!newTweetContent.trim()"
                >
                    Post Tweet
                </button>
            </div>
        } @else {
            @if (tweets().length) {
                <div class="tweet-feed">
                    @for (tweet of tweets(); track tweet.id) {
                        <div class="tweet-card">
                            <div class="tweet-header">
                                <strong>
                                    {{ tweet.author?.firstName }} {{ tweet.author?.lastName }}
                                    @if (tweet.author?.id === authState.userId()) {
                                        <span class="text-muted">(You)</span>
                                    }
                                </strong>
                                <span class="tweet-date">{{ tweet.createdAt | date: 'short' }}</span>
                            </div>

                            <p class="tweet-content">{{ tweet.content }}</p>

                            <div class="tweet-actions d-flex justify-content-between align-items-center">
                                <div>
                                    <button class="btn btn-sm btn-outline-secondary me-2" (click)="likeTweet(tweet.id)">
                                        üëç {{ tweet.likes?.length || 0 }} Likes
                                    </button>

                                    <button
                                        class="btn btn-sm btn-outline-secondary me-2"
                                        (click)="toggleReplies(tweet.id)"
                                    >
                                        üí¨ {{ tweet.replies?.length || 0 }} Replies
                                    </button>

                                    @if (tweet.author?.id === authState.userId()) {
                                        <button
                                            class="btn btn-sm btn-outline-danger"
                                            (click)="deleteTweet(tweet.id)"
                                        >
                                            üóëÔ∏è Delete
                                        </button>
                                    }
                                </div>
                            </div>

                            @if (isRepliesVisible(tweet.id)()) {
                                <div class="tweet-replies mt-3">
                                    <div class="mb-3">
                                        <textarea
                                            rows="2"
                                            class="form-control mb-2"
                                            placeholder="Write a reply..."
                                            [value]="replyInputs()[tweet.id] || ''"
                                            (input)="updateReplyInput(tweet.id, $any($event.target).value)"
                                        ></textarea>
                                        <button class="btn btn-primary btn-sm" (click)="sendReply(tweet.id)">
                                            Reply
                                        </button>
                                    </div>

                                    @for (reply of tweet.replies || []; track reply.id) {
                                        <div class="reply mb-2">
                                            <strong>{{ reply.author?.firstName }} {{ reply.author?.lastName }}</strong>
                                            <span class="reply-date">{{ reply.createdAt | date: 'short' }}</span>
                                            <p>{{ reply.content }}</p>

                                            @if (reply.author?.id === authState.userId()) {
                                                <button
                                                    class="btn btn-sm btn-outline-danger"
                                                    (click)="deleteReply(tweet.id, reply.id)"
                                                >
                                                    üóëÔ∏è Delete
                                                </button>
                                            }
                                        </div>
                                    }
                                </div>
                            }
                        </div>
                    }
                </div>
            } @else {
                <p>No tweets to show.</p>
            }
        }
    </div>
</div>
